#
# Zesk Build BitBucket Pipeline
#
# Copyright &copy; 2023 Market Acumen Inc.
#
# Test run:
#
# docker run --platform linux/arm64 -v $(pwd):/opt/atlassian/bitbucketci/agent/build -it atlassian/default-image:4
# rm -rf .build/ test.*; set -a; source .env.prod-robot ; bin/test.sh
#
image: atlassian/default-image:4

pipelines:
  branches:
    develop:
      - step:
          deployment: develop
          name: Build and Test
          services:
            - docker
          script:
            - bin/test.sh
    main:
      - step:
          deployment: production
          name: Build, Test, and Deploy
          services:
            - docker
          script:
            - bin/test.sh
            - bin/deploy.sh
