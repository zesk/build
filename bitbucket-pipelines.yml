#
# Zesk Build BitBucket Pipeline
#
# Copyright &copy; 2024 Market Acumen Inc.
#
# Test run:
#
# bin/build/local-container.sh .env.PRODUCTION
#
image: atlassian/default-image:4

pipelines:
  branches:
    docs:
      - step:
          deployment: docs
          name: Build documentation
          services:
            - docker
          script:
            - bin/build/tools.sh aptInstall
            - bin/build-docs.sh
            - ! bin/build/tools.sh gitRepositoryChanged || git commit -m "Updated docs in pipeline on $(date +"%F %T")" -a
    staging:
      - step:
          deployment: staging
          name: Build and Test
          services:
            - docker
          script:
            - bin/build.sh
            - bin/test.sh
    main:
      - step:
          deployment: production
          name: Build, Test, and Deploy
          services:
            - docker
          script:
            - bin/build.sh
            - bin/test.sh
            - bin/deploy.sh
