#################################################################################
### Paths and global environment
#################################################################################

DefaultRuntimeDir       ${APACHE_RUN_DIR}
PidFile 			    ${APACHE_PID_FILE}

User 				    ${APACHE_RUN_USER}
Group                   ${APACHE_RUN_GROUP}

ServerSignature 	    Off
ServerTokens		    OS

#################################################################################
### Modules
#################################################################################

IncludeOptional         mods-enabled/*.load
IncludeOptional         mods-enabled/*.conf

#################################################################################
### Tuning Parameters
#################################################################################

# Timeout: The number of seconds before receives and sends time out.
Timeout					30
# Default: Timeout 300

KeepAlive 				On
MaxKeepAliveRequests	100
KeepAliveTimeout 		5

ExtendedStatus			On
HostnameLookups 		Off
FileETag                none

ServerLimit         ${APACHE_SERVER_LIMIT}
StartServers        ${APACHE_START_SERVERS}
MaxRequestWorkers   ${APACHE_MAX_REQUEST_WORKERS}
MinSpareThreads     ${APACHE_MIN_SPARE_THREADS}
MaxSpareThreads     ${APACHE_MAX_SPARE_THREADS}
ThreadsPerChild     ${APACHE_THREADS_PER_CHILD}

#################################################################################
### Logging
#################################################################################

LogLevel        warn

LogFormat 		"%v %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined

SetEnvIf 		X-Forwarded-For "^.*\..*\..*\..*" forwarded
LogFormat 		"%V:%p %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined
LogFormat 		"%V:%p %{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined_proxy

ErrorLog 		${APACHE_LOG_PATH}/error.log
CustomLog 		"|${CRONOLOG} --link=${APACHE_LOG_PATH}/access.log --period=days --time-zone=UTC ${APACHE_LOG_PATH}/access-%Y-%m-%d.log" vhost_combined


#################################################################################
### Permissions
#################################################################################
<Directory />
	Options FollowSymLinks
	AllowOverride None
	Require all denied
</Directory>

<Directory /var/www/apps/>
	Options FollowSymLinks
	AllowOverride None
	Require all granted
</Directory>

<IfModule mod_dir.c>
   DirectoryIndex index.html index.php
</IfModule>

AccessFileName .htaccess

<Files ~ "^\.ht">
	Require all denied
</Files>

##################################################################################
#### Apache configuration
##################################################################################

Listen 80
IncludeOptional conf-enabled/*.conf
IncludeOptional sites-enabled/*.conf

# PCI Compliance
Header always set X-Content-Type-Options: nosniff
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

ServerTokens Prod
ServerSignature Off

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
